<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <title>Copas - Coroutine Oriented Portable Asynchronous Services for Lua</title>
    <link rel="stylesheet" href="http://www.keplerproject.org/doc.css" type="text/css">
</head>
<body>
<div id="container">

<div id="product">
<a href="http://www.keplerproject.org"><img alt="Copas" src="copas.png" /></a>
<big><strong>Copas</strong></big> - 
Coroutine Oriented Portable Asynchronous Services for Lua
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">
<h1>Copas</h1>
<ul>
    <li><a href="index.html">Home</a>
        <ul>
            <li><a href="index.html#over">Overview</a></li>
            <li><a href="index.html#version">Current Version</a></li>
            <li><a href="index.html#download">Download</a></li>
            <li><a href="index.html#history">History</a></li>
            <li><a href="index.html#credits">Credits</a></li>
            <li><a href="index.html#contact">Contact us</a></li>
        </ul>
    </li>
    <li><a href="examples.html">Examples</a></li>
    <li><strong>Reference</strong></li>
    <li><a href="license.html">License</a></li>
</ul>
</div> <!-- id="navigation" -->

<div id="content">
<h2>Reference</h2>

<p>
Copas functions are separated in two groups.</p>
<p>
The first group is relative to the use of the dispatcher itself and
are used to register servers and to execute the main loop of Copas:</p>

<ul>
<li>
<b><code>copas.addserver(server, handler[, timeout])</code></b>
<br>
Adds a new <code>server</code> and its <code>handler</code> to the dispatcher
using an optional <code>timeout</code>.<br>
<code>server</code> is a LuaSocket server socket created using
<code>socket.bind()</code>.<br>
<code>handler</code> is a function that receives a LuaSocket client socket
and handles the communication with that client.<br>
<code>timeout</code> is the timeout for blocking I/O in seconds.
</li>
<li>
<b><code>copas.loop()</code></b>
<br>
Starts the Copas infinite loop accepting client connections for the 
registered servers and handling those connections with the corresponding
handlers. Every time a server accepts a connection, Copas calls the
associated handler passing the client socket returned by
<code>accept()</code>.
</li>
</ul>

<p>The second group is used by the handler functions to exchange data with
the clients:</p>
<ul>
<li>
<b><code>copas.flush(skt)</code></b>
<br>
Flushes a client write buffer. <code>copas.flush()</code> is called from time
to time by <code>copas.loop()</code> but it may be necessary to call it from
the handler function.
</li>
<li>
<b><code>copas.receive(skt, pattern)</code></b>
<br>
Reads data from a client socket according to a pattern just like LuaSocket
<code>socket:receive()</code>. The Copas version does not block and allows
the multitasking of the other handlers.
</li>
<li>
<b><code>copas.send(skt, data)</code></b>
<br>
Sends data to a client socket just like <code>socket:send()</code>. The Copas version
is buffered and does not block, allowing the multitasking of the other handlers.
</li>
<li>
<b><code>copas.wrap(skt)</code></b>
<br>
Wraps a LuaSocket socket and returns a Copas socket that implements LuaSocket's API
but use Copas' methods <code>copas.send()</code> and <code>copas.receive()</code>
automatically.
</li>
</ul>
</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-html401" alt="Valid HTML 4.01!" height="31" width="88"></a></p>
	<p><small>
	$Id: reference.html,v 1.6 2005/03/13 20:53:50 carregal Exp $
	</small></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->
</body>
</html>